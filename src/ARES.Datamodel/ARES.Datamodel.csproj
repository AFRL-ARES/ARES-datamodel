<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>net8.0</TargetFramework>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
    <PackageId>ARES.Datamodel</PackageId>
    <Authors>DCS</Authors>
    <Company>DCS</Company>
    <Description>Generated Protobuf and gRPC C# classes for the ARES datamodel.</Description>
    <RepositoryUrl>https://github.com/AFRL-ARES/ARES-datamodel</RepositoryUrl>
    <PackageProjectUrl>https://github.com/AFRL-ARES/ARES-datamodel</PackageProjectUrl>
    <PackageTags>protobuf;grpc;csharp;generated</PackageTags>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Google.Protobuf" Version="3.31.1" />
    <PackageReference Include="Grpc.Net.Client" Version="2.71.0" />
    <PackageReference Include="Grpc.Tools" Version="2.72.0" PrivateAssets="all" />
  </ItemGroup>


  <PropertyGroup>
    <RepoRoot>$(MSBuildProjectDirectory)\..\..</RepoRoot>
    <ProtoPaths>$(RepoRoot)\protos\data_model;$(RepoRoot)\protos\services</ProtoPaths>
  </PropertyGroup>

  <ItemGroup Label="Protobuf Compile">
    <_Asset Include="$(RepoRoot)\protos\data_model\**\*.proto" />
    <Protobuf Include="@(_Asset)" Visible="True" GrpcServices="None"
      AdditionalImportDirs="$(ProtoPaths)" />
  </ItemGroup>

  <ItemGroup Label="Protobuf Compile">
    <_Asset Include="$(RepoRoot)\protos\services\**\*.proto" />
    <Protobuf Include="@(_Asset)" Visible="True" GrpcServices="Both"
      AdditionalImportDirs="$(ProtoPaths)" />
  </ItemGroup>

  <ItemGroup>
    <Protobuf
      Update="$(RepoRoot)\protos\data_model\analyzing\remote\ares_remote_analyzer_service.proto"
      GrpcServices="Both" AdditionalImportDirs="$(ProtoPaths)" />
    <Protobuf Update="$(RepoRoot)\protos\data_model\planning\ares_planner.proto"
      GrpcServices="Client" AdditionalImportDirs="$(ProtoPaths)" />
  </ItemGroup>

  <!-- Included the proto files themselves in case there's a need to include them in further
      custom messages -->
  <ItemGroup Label="Nuget Packaging">
    <_Asset PackagePath="\Proto\" Include="$(RepoRoot)\protos\**\*.proto" />
    <None Include="@(_Asset)" Pack="true" Visible="False" />
  </ItemGroup>
</Project>